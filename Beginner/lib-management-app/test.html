<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test html</title>
    <script>
	class LocalDatabase {
    /**
     * This class will be used to perform operations related to the localStorage, it will 
     * Take care of the required functionality working with the localStorage database.
     * 
     * In this we will take care of reading, writing and updating and deleting data from 
     * local storage.
     */

    static DatabaseKey = 'database'; // it must contain the name of the database.
    static Records = []; // it must contain the instance of the class or subclass.
    static RowRecord = null;
    // it will be our row object retrieved form the database.
    static UniqueId = 1;
    static Fields = ["id", "regDate", "updateDate"]; // it must contain the all fields which are going to be stored in the database.
    static view_fields = [] // a list of fields which will be displayed on the table.
    constructor({ id, regDate, updateDate }) {
        if (id) {
            // if id is already in the with the already stored data, then we need 
            // use that existing id.
            this.id = id;
            this.setId(id);
        }
        else {
            // if id is not in the database, then we need to create one.
            this.id = LocalDatabase.increaseId();
        }

        if (regDate) {
            // if registration date is given then we need to use that existing date.
            this.regDate = regDate;
        }
        else {
            let date = new Date()
            this.regDate = date.toLocaleDateString();
        }

        if (updateDate) {
            // if an update date is given then we need to use that existing date.
            this.updateDate = updateDate;
        }
        else {
            this.updateDate = null;
        }

        LocalDatabase.pushRecord(this)

    }

    static setId(id) {
        this.UniqueId = id;
    }

    static increaseId() {
        return this.UniqueId++;
    }

    static pushRecord(record) {
        this.Records.push(record)
    }

    static setRecord(key, value) {
        /**
         * this function will be used to store the data in key value pair to the local storage.
         */
        let data = JSON.stringify(value);
        localStorage.setItem(key, data);
    }


    static getRecord(key) {
        /**
         * this function will be used to get the data in key value pair form local storage.
         */
        let data = localStorage.getItem(key)
        if (data) {
            return JSON.parse(data)
        }
        return { "fields": this.Fields, values: [] }
    }

    updateField(key, value) {
        // a method that updates the instance data field with given value.
        this[key] = value;
    }

    static load() {
        // this method will load the data from the database and it will create instances.
        this.RowRecord = this.getRecord(this.DatabaseKey);
        // Now after loading the Row data now we need to create a new instances for our 
        // application.
        let obj = {}

        this.RowRecord.values.forEach(record => {
            this.Fields.forEach((field, index) => {
                obj[field] = record[index];
            })
            new this(obj)
        })
    }

    toArray() {
        return LocalDatabase.Fields.map((key) => this[key])
    }

    save() {
        // to save the instance record , first we need to get the data in array format.
        // then we need to push that record into the RowRecord
        LocalDatabase.RowRecord.values.push(this.toArray())
        // Now after pushing the record we need to save that into the localStorage.
        LocalDatabase.setRecord(LocalDatabase.DatabaseKey, LocalDatabase.RowRecord)
    }

    static saveAll() {
        // a method to save the all instance to the database with current data.
        let data = {
            "fields": this.fields,
            'values': this.Records.map((record) => record.toArray())
        }
        this.setRecord(this.database, data)
    }

}


class Student extends LocalDatabase {

		
		  static {
       super.Fields =  super.Fields.concat(["name", "class", "email", "contact",
            "address", "current_issued_book", "is_finned", "finned_amount", "is_returned", "returned_date", "Image"
        ])
        super.DatabaseKey = 'Students';
    }
		
       constructor({ id, name, _class, email, contact, address, current_issued_book, regDate, updateDate, is_finned, finned_amount, is_returned, returned_date, Image }) {

        super({ id, regDate, updateDate })
        this.name = name;
        this.class = _class;
        this.email = email;
        this.contact = contact;
        this.address = address;
        this.current_issued_book = current_issued_book;
        this.is_finned = is_finned;
        this.finned_amount = finned_amount;
        this.is_returned = is_returned;
        this.returned_date = returned_date;
        this.Image = Image;

   
    }

}   
</script>
</head>

<body>

</body>

</html>